(function(d){var i=d.Vector3DUtil;var f=d.JConfig;var j=d.JIndexedTriangle;var g=d.JSphere;var e=d.JTriangle;var c=d.JTriangleMesh;var a=d.JNumber3D;var b=d.MaterialProperties;var k=d.RigidBody;var h=function(){this.name="SphereMesh";this.type0="SPHERE";this.type1="TRIANGLEMESH";};d.extend(h,d.CollDetectFunctor);h.prototype.collDetectSphereStaticMeshOverlap=function(t,n,J,w,F){var K=J.body0.get_oldState().position;var o=J.body1.get_oldState().position;var p=w+t.get_radius();var C=p*p;var G=new Vector3D();var B=[];var x=[];var r=n.octree.getTrianglesIntersectingtAABox(x,t.get_boundingBox());var H,q,N,z,M,s=a.NUM_TINY;var l;var v;var m;var E;for(var D=0;D<r;++D){l=n.octree.getTriangle(x[D]);q=l.plane.pointPlaneDistance(t.get_currentState().position);if(q<=0){continue;}if(q>=p){continue;}v=l.get_vertexIndices();E=new e(n.octree.getVertex(v[0]),n.octree.getVertex(v[1]),n.octree.getVertex(v[2]));m=[];H=E.pointTriangleDistanceSq(m,t.get_currentState().position);if(H<C){N=E.pointTriangleDistanceSq(m,t.get_oldState().position);z=Math.sqrt(N);M=t.get_radius()-z;var L=(z>s)?(i.subtract(t.get_oldState().position,E.getPoint(m[0],m[1]))):i.clone(E.normal);i.normalize(L);var y=i.subtract(t.get_oldState().position,a.getScaleVector(L,t.get_radius()));var u=new CollPointInfo();u.r0=i.subtract(y,K);u.r1=i.subtract(y,o);u.initialPenetration=M;B.push(u);G=i.add(G,L);i.normalize(G);}}var A=new CollisionInfo();A.objInfo=J;A.dirToBody=G;A.pointInfo=B;var I=new b();I.set_restitution(0.5*(t.get_material().get_restitution()+n.get_material().get_restitution()));I.set_friction(0.5*(t.get_material().get_friction()+n.get_material().get_friction()));A.mat=I;F.push(A);J.body0.collisions.push(A);J.body1.collisions.push(A);};h.prototype.collDetect=function(o,n){var l;if(o.body0._type=="TRIANGLEMESH"){l=o.body0;o.body0=o.body1;o.body1=l;}var m=o.body0;var p=o.body1;this.collDetectSphereStaticMeshOverlap(m,p,o,f.collToll,n);};d.CollDetectSphereMesh=h;})(jigLib);