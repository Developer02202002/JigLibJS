(function(b){var d=b.Vector3DUtil;var a=b.CollOutBodyData;var g=b.JSegment;var c=b.JNumber3D;var f=b.RigidBody;var e=function(){this.collBody=[];this.detectionFunctors={};this.detectionFunctors["BOX_BOX"]=new b.CollDetectBoxBox();this.detectionFunctors["BOX_SPHERE"]=new b.CollDetectSphereBox();this.detectionFunctors["BOX_CAPSULE"]=new b.CollDetectCapsuleBox();this.detectionFunctors["BOX_PLANE"]=new b.CollDetectBoxPlane();this.detectionFunctors["BOX_TERRAIN"]=new b.CollDetectBoxTerrain();this.detectionFunctors["BOX_TRIANGLEMESH"]=new b.CollDetectBoxMesh();this.detectionFunctors["SPHERE_BOX"]=new b.CollDetectSphereBox();this.detectionFunctors["SPHERE_SPHERE"]=new b.CollDetectSphereSphere();this.detectionFunctors["SPHERE_CAPSULE"]=new b.CollDetectSphereCapsule();this.detectionFunctors["SPHERE_PLANE"]=new b.CollDetectSpherePlane();this.detectionFunctors["SPHERE_TERRAIN"]=new b.CollDetectSphereTerrain();this.detectionFunctors["SPHERE_TRIANGLEMESH"]=new b.CollDetectSphereMesh();this.detectionFunctors["CAPSULE_CAPSULE"]=new b.CollDetectCapsuleCapsule();this.detectionFunctors["CAPSULE_BOX"]=new b.CollDetectCapsuleBox();this.detectionFunctors["CAPSULE_SPHERE"]=new b.CollDetectSphereCapsule();this.detectionFunctors["CAPSULE_PLANE"]=new b.CollDetectCapsulePlane();this.detectionFunctors["CAPSULE_TERRAIN"]=new b.CollDetectCapsuleTerrain();this.detectionFunctors["PLANE_BOX"]=new b.CollDetectBoxPlane();this.detectionFunctors["PLANE_SPHERE"]=new b.CollDetectSpherePlane();this.detectionFunctors["PLANE_CAPSULE"]=new b.CollDetectCapsulePlane();this.detectionFunctors["TERRAIN_SPHERE"]=new b.CollDetectSphereTerrain();this.detectionFunctors["TERRAIN_BOX"]=new b.CollDetectBoxTerrain();this.detectionFunctors["TERRAIN_CAPSULE"]=new b.CollDetectCapsuleTerrain();this.detectionFunctors["TRIANGLEMESH_SPHERE"]=new b.CollDetectSphereMesh();this.detectionFunctors["TRIANGLEMESH_BOX"]=new b.CollDetectBoxMesh();};e.prototype.detectionFunctors={};e.prototype.collBody=null;e.prototype._numCollisionsChecks=0;e.prototype.addCollisionBody=function(h){if(!this.findBody(h)){this.collBody.push(h);}};e.prototype.removeCollisionBody=function(h){if(this.findBody(h)){this.collBody.splice(this.collBody.indexOf(h),1);}};e.prototype.removeAllCollisionBodies=function(){this.collBody=[];};e.prototype.detectCollisions=function(h,m){if(!this.body.isActive){return;}var n;var o;for(var l=0;i<this.collBody.length;l++){var k=this.collBody[l];if(h==k){continue;}if(this.checkCollidables(h,k)&&this.detectionFunctors[h.type+"_"+k.type]!=undefined){n=new CollDetectInfo();n.body0=h;n.body1=k;o=this.detectionFunctors[n.body0.type+"_"+n.body1.type];o.collDetect(n,m);}}};e.prototype.detectAllCollisions=function(h,k){};e.prototype.collisionSkinMoved=function(h){};e.prototype.segmentIntersect=function(m,h,l){m.frac=c.NUM_HUGE;m.position=[];m.normal=[];var n=new a();for(j=0;j<this.collBody.length;j++){var k=this.collBody[j];if(k!=l&&this.segmentBounding(h,k)){if(k.segmentIntersect(n,h,k.get_currentState())){if(n.frac<m.frac){m.position=n.position;m.normal=n.normal;m.frac=n.frac;m.rigidBody=k;}}}}if(m.frac>1){return false;}if(m.frac<0){m.frac=0;}else{if(m.frac>1){m.frac=1;}}return true;};e.prototype.segmentBounding=function(h,n){var o=h.getPoint(0.5);var k=d.get_length(h.delta)/2;var m=d.get_length(d.subtract(o,n.get_currentState().position));var l=k+n.boundingSphere;if(m<=l){return true;}else{return false;}};e.prototype.get_numCollisionsChecks=function(){return this._numCollisionsChecks;};e.prototype.findBody=function(h){return this.collBody.indexOf(h)>-1;};e.prototype.checkCollidables=function(k,h){if(k._nonCollidables.length==0&&h._nonCollidables.length==0){return true;}if(k._nonCollidables.indexOf(h)>-1){return false;}if(h._nonCollidables.indexOf(k)>-1){return false;}return true;};b.CollisionSystemAbstract=e;})(jigLib);