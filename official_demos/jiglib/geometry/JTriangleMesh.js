(function(d){var h=d.Vector3DUtil;var a=d.JNumber3D;var e=d.Matrix3D;var g=d.CollOutData;var i=d.TriangleVertexIndices;var b=d.PhysicsState;var l=d.RigidBody;var f=d.ISkin3D;var c=function(q,o,n,p,m){if(p==undefined){p=10;}if(m==undefined){m=10;}this.Super(q);this.get_currentState().position=h.clone(o);this.get_currentState().set_orientation(h.clone(n));this._maxTrianglesPerCell=p;this._minCellSize=m;this.set_movable(false);if(q){this._skinVertices=q.vertices;this.createMesh(this._skinVertices,q.indices);this._boundingBox=this._octree.boundingBox().clone();this._boundingSphere=this._boundingBox.getRadiusAboutCentre();}this._type="TRIANGLEMESH";};d.extend(c,d.RigidBody);c.prototype.createMesh=function(p,t){var m=p.length;var s=[];var o=JMatrix3D.getTranslationMatrix(this.get_currentState().position[0],this.get_currentState().position[1],this.get_currentState().position[2]);o=JMatrix3D.getAppendMatrix3D(this.get_currentState().get_orientation(),o);var q=0;for(var n=0;n<p.length;n++){var r=p[n];s[q++]=this.transform.transformVector(r);}this._octree=new JOctree();this._octree.addTriangles(s,s.length,t,t.length);this._octree.buildOctree(this._maxTrianglesPerCell,_minCellSize);};c.prototype.get_octree=function(){return this._octree;};c.prototype.segmentIntersect=function(p,q,m){var n=new JAABox();n.addSegment(q);var o=[];var u=this._octree.getTrianglesIntersectingtAABox(o,n);var t=a.NUM_HUGE;var v;var r;for(var s=0;s<numTriangles;s++){r=this._octree.getTriangle(o[s]);v=new JTriangle(this._octree.getVertex(r.getVertexIndex(0)),this._octree.getVertex(r.getVertexIndex(1)),this._octree.getVertex(r.getVertexIndex(2)));if(v.segmentTriangleIntersection(p,q)){if(p.frac<t){t=p.frac;p.position=q.getPoint(t);p.normal=r.plane.normal;}}}p.frac=t;if(t<a.NUM_HUGE){return true;}else{return false;}};c.prototype.updateState=function(){this.Super.updateState();var m=this._skinVertices.length;var q=[];var n=JMatrix3D.getTranslationMatrix(this.get_currentState().position[0],this.get_currentState().position[1],this.get_currentState().position[2]);n=JMatrix3D.getAppendMatrix3D(this.get_currentState().get_orientation(),n);var o=0;for(k=0;j<this._skinVertices.length;j++){var p=this._skinVertices[j];q[o++]=n.transformVector(p);}this._octree.updateTriangles(q);this._octree.buildOctree(this._maxTrianglesPerCell,this._minCellSize);this._boundingBox=this._octree.boundingBox().clone();};d.JTriangleMesh=c;})(jigLib);