(function(c){var e=c.Vector3DUtil;var b=c.JMatrix3D;var d=c.JNumber3D;var g=c.JConstraint;var f=c.RigidBody;var a=function(k,m,i,j,l,h){this.Super();this._body0=k;this._body0Pos=m;this._body1=i;this._body1Pos=j;this._allowedDistance=(l)?l:1;this._timescale=(h)?h:1;if(this._timescale<d.NUM_TINY){_timescale=d.NUM_TINY;}k.addConstraint(this);i.addConstraint(this);};c.extend(a,c.JConstraint);a.prototype._maxVelMag=20;a.prototype._minVelForProcessing=0.01;a.prototype._body0=null;a.prototype._body1=null;a.prototype._body0Pos=null;a.prototype._body1Pos=null;a.prototype._timescale=null;a.prototype._allowedDistance=null;a.prototype.r0=null;a.prototype.r1=null;a.prototype._worldPos=null;a.prototype._vrExtra=null;a.prototype.preApply=function(l){this.set_satisfied(false);this.r0=this._body0Pos.slice(0);b.multiplyVector(this._body0.get_currentState().get_orientation(),this.r0);this.r1=this._body1Pos.slice(0);b.multiplyVector(this._body1.get_currentState().get_orientation(),this.r1);var i=e.add(this._body0.get_currentState().position,this.r0);var h=e.add(this._body1.get_currentState().position,this.r1);this._worldPos=d.getScaleVector(e.add(i,h),0.5);var k=e.subtract(i,h);var j=e.get_length(k);if(j>this._allowedDistance){this._vrExtra=d.getScaleVector(k,(j-this._allowedDistance)/(j*Math.max(this._timescale,l)));}else{this._vrExtra=[0,0,0,0];}};a.prototype.apply=function(j){this.set_satisfied(true);if(!this._body0.isActive&&!this._body1.isActive){return false;}var o=this._body0.getVelocity(this.r0);var n=this._body1.getVelocity(this.r1);var h=e.add(this._vrExtra,e.subtract(o,n));var m=e.get_length(h);if(m<this._minVelForProcessing){return false;}if(m>this._maxVelMag){h=d.getScaleVector(h,this._maxVelMag/m);m=this._maxVelMag;}var p=d.getDivideVector(h,m);var r=e.crossProduct(this.r0,p);b.multiplyVector(this._body0.get_worldInvInertia(),r);var q=e.crossProduct(this.r1,p);b.multiplyVector(this._body1.get_worldInvInertia(),q);var l=this._body0.get_invMass()+this._body1.get_invMass()+e.dotProduct(p,e.crossProduct(r,this.r0))+e.dotProduct(p,e.crossProduct(q,this.r1));if(l<d.NUM_TINY){return false;}var k=d.getScaleVector(p,-m/l);var i=d.getScaleVector(k,-1);this._body0.applyWorldImpulse(k,this._worldPos);this._body1.applyWorldImpulse(i,this._worldPos);this._body0.setConstraintsAndCollisionsUnsatisfied();this._body1.setConstraintsAndCollisionsUnsatisfied();this.set_satisfied(true);return true;};c.JConstraintPoint=a;})(jigLib);