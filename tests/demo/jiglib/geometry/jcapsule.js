(function(d){var h=d.Vector3DUtil;var e=d.JMatrix3D;var b=d.JNumber3D;var f=d.ISkin3D;var c=d.PhysicsState;var j=d.RigidBody;var i=d.JSegment;var g=function(n,m,k){this.Super(n);this._type="CAPSULE";this._radius=m;this._length=k;this._boundingSphere=this.getBoundingSphere(m,k);this.set_mass(1);this.updateBoundingBox();};d.extend(g,d.RigidBody);g.prototype._length=null;g.prototype._radius=null;g.prototype.set_radius=function(k){this._radius=k;this._boundingSphere=getBoundingSphere(this._radius,this._length);this.setInertia(this.getInertiaProperties(this.get_mass()));this.updateBoundingBox();this.setActive();};g.prototype.get_radius=function(){return this._radius;};g.prototype.set_length=function(k){this._length=k;this._boundingSphere=getBoundingSphere(this._radius,this._length);this.setInertia(this.getInertiaProperties(this.get_mass()));this.updateBoundingBox();this.setActive();};g.prototype.get_length=function(){return this._length;};g.prototype.getBottomPos=function(l){var k=l.getOrientationCols()[1];return h.add(l.position,b.getScaleVector(k,-this._length/2-this._radius));};g.prototype.getEndPos=function(l){var k=l.getOrientationCols()[1];return h.add(l.position,b.getScaleVector(k,this._length/2+this._radius));};g.prototype.segmentIntersect=function(A,C,p){A.fracOut=0;A.posOut=[0,0,0,0];A.normalOut=[0,0,0,0];var l=C.delta;var E=h.dotProduct(l,l);var z=this._radius*this._radius;var w=p.getOrientationCols();var r=new i(getBottomPos(p),w[1]);var u=r.delta;var q=h.subtract(r.origin,C.origin);var v=h.dotProduct(u,u);if(Math.abs(v)<b.NUM_TINY){return false;}var m=h.dotProduct(u,l);var B=h.dotProduct(q,l);var s=h.dotProduct(u,q);var k=h.dotProduct(q,q);var o=h.get_lengthSquared(h.subtract(q,b.getDivideVector(b.getScaleVector(u,s),v)));if(o<z){A.fracOut=0;A.posOut=C.origin.slice(0);A.normalOut=h.subtract(A.posOut,getBottomPos(p));A.normalOut=h.subtract(A.normalOut,b.getScaleVector(w[1],h.dotProduct(A.normalOut,w[1])));h.normalize(A.normalOut);return true;}var y=v*E-(m*m);if(Math.abs(a)<b.NUM_TINY){return false;}var F=2*(s*m-v*B);var D=v*(k-z)-(s*s);var n=(F*F)-4*a*D;if(n<0){return false;}var x=(-F-Math.sqrt(n))/(2*a);if(x<0||x>1){return false;}A.fracOut=x;A.posOut=C.getPoint(x);A.normalOut=h.subtract(A.posOut,getBottomPos(p));A.normalOut=h.subtract(A.normalOut,b.getScaleVector(w[1],h.dotProduct(A.normalOut,w[1])));h.normalize(A.normalOut);return true;};g.prototype.getInertiaProperties=function(k){var o=k*Math.PI*this._radius*this._radius*this._length/this.getVolume();var l=0.25*o*this._radius*this._radius+(1/12)*o*this._length*this._length;var n=0.5*o*this._radius*this._radius;var p=l;var q=k-o;l+=(0.4*q*this._radius*this._radius+q*Math.pow(0.5*this._length,2));n+=(0.2*q*this._radius*this._radius);p+=(0.4*q*this._radius*this._radius+q*Math.pow(0.5*this._length,2));return e.getScaleMatrix(l,n,p);};g.prototype.updateBoundingBox=function(){this._boundingBox.clear();this._boundingBox.addCapsule(this);};g.prototype.getBoundingSphere=function(m,k){return Math.sqrt(Math.pow(k/2,2)+m*m)+m;};g.prototype.getVolume=function(){return(4/3)*Math.PI*this._radius*this._radius*this._radius+this._length*Math.PI*this._radius*this._radius;};d.JCapsule=g;})(jigLib);