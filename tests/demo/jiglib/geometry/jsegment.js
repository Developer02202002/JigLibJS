(function(b){var e=b.Vector3DUtil;var c=b.JNumber3D;var a=b.PhysicsState;var d=b.JRay;var f=function(h,g){this.origin=h;this.delta=g;};f.prototype.origin=null;f.prototype.delta=null;f.prototype.getPoint=function(g){return e.add(this.origin,c.getScaleVector(this.delta,g));};f.prototype.getEnd=function(){return e.add(this.origin,this.delta);};f.prototype.clone=function(){return new f(this.origin,this.delta);};f.prototype.segmentSegmentDistanceSq=function(k,l){k.t0=0;k.t1=0;var s=e.subtract(this.origin,l.origin);var p=e.get_lengthSquared(this.delta);var o=-e.dotProduct(this.delta,l.delta);var j=e.get_lengthSquared(l.delta);var i=e.dotProduct(s,this.delta);var n=e.get_lengthSquared(s);var u=Math.abs(p*j-o*o);var h;var t;var r;var m;var q;if(u>=c.NUM_TINY){h=-e.dotProduct(s,l.delta);t=o*h-j*i;r=o*i-p*h;if(t>=0){if(t<=u){if(r>=0){if(r<=u){var g=1/u;t*=g;r*=g;m=t*(p*t+o*r+2*i)+r*(o*t+j*r+2*h)+n;}else{r=1;q=o+i;if(q>=0){t=0;m=j+2*h+n;}else{if(-q>=p){t=1;m=p+j+n+2*(h+q);}else{t=-q/p;m=q*t+j+2*h+n;}}}}else{r=0;if(i>=0){t=0;m=n;}else{if(-i>=p){t=1;m=p+2*i+n;}else{t=-i/p;m=i*t+n;}}}}else{if(r>=0){if(r<=u){t=1;q=o+h;if(q>=0){r=0;m=p+2*i+n;}else{if(-q>=j){r=1;m=p+j+n+2*(i+q);}else{r=-q/j;m=q*r+p+2*i+n;}}}else{q=o+i;if(-q<=p){r=1;if(q>=0){t=0;m=j+2*h+n;}else{t=-q/p;m=q*t+j+2*h+n;}}else{t=1;q=o+h;if(q>=0){r=0;m=p+2*i+n;}else{if(-q>=j){r=1;m=p+j+n+2*(i+q);}else{r=-q/j;m=q*r+p+2*i+n;}}}}}else{if(-i<p){r=0;if(i>=0){t=0;m=n;}else{t=-i/p;m=i*t+n;}}else{t=1;q=o+h;if(q>=0){r=0;m=p+2*i+n;}else{if(-q>=j){r=1;m=p+j+n+2*(i+q);}else{r=-q/j;m=q*r+p+2*i+n;}}}}}}else{if(r>=0){if(r<=u){t=0;if(h>=0){r=0;m=n;}else{if(-h>=j){r=1;m=j+2*h+n;}else{r=-h/j;m=h*r+n;}}}else{q=o+i;if(q<0){r=1;if(-q>=p){t=1;m=p+j+n+2*(h+q);}else{t=-q/p;m=q*t+j+2*h+n;}}else{t=0;if(h>=0){r=0;m=n;}else{if(-h>=j){r=1;m=j+2*h+n;}else{r=-h/j;m=h*r+n;}}}}}else{if(i<0){r=0;if(-i>=p){t=1;m=p+2*i+n;}else{t=-i/p;m=i*t+n;}}else{t=0;if(h>=0){r=0;m=n;}else{if(-h>=j){r=1;m=j+2*h+n;}else{r=-h/j;m=h*r+n;}}}}}}else{if(o>0){if(i>=0){t=0;r=0;m=n;}else{if(-i<=p){t=-i/p;r=0;m=i*t+n;}else{h=-e.dotProduct(s,l.delta);t=1;q=p+i;if(-q>=o){r=1;m=p+j+n+2*(o+i+h);}else{r=-q/o;m=p+2*i+n+r*(j*r+2*(o+h));}}}}else{if(-i>=p){t=1;r=0;m=p+2*i+n;}else{if(i<=0){t=-i/p;r=0;m=i*t+n;}else{h=-e.dotProduct(s,l.delta);t=0;if(i>=-o){r=1;m=j+2*h+n;}else{r=-i/o;m=n+r*(2*h+j*r);}}}}}k.t0=t;k.t1=r;return Math.abs(m);};f.prototype.pointSegmentDistanceSq=function(h,i){h.t=0;var k=e.subtract(i,this.origin);var j=e.dotProduct(k,this.delta);if(j<=0){j=0;}else{var g=e.get_lengthSquared(this._delta);if(j>=g){j=1;k=e.subtract(k,this._delta);}else{j/=g;k=e.subtract(k,c.getScaleVector(this._delta,j));}}h.t=j;return e.get_lengthSquared(k);};f.prototype.segmentBoxDistanceSq=function(h,g,l){h.pfLParam=0;h.pfLParam0=0;h.pfLParam1=0;h.pfLParam2=0;var k={};var j=new d(this.origin,this.delta);var i=this.sqrDistanceLine(k,j,g,l);if(k.num>=0){if(k.num<=1){h.pfLParam=k.num;h.pfLParam0=k.num0;h.pfLParam1=k.num1;h.pfLParam2=k.num2;return Math.max(i,0);}else{i=this.sqrDistancePoint(h,e.add(this.origin,this.delta),g,l);h.pfLParam=1;return Math.max(i,0);}}else{i=this.sqrDistancePoint(h,this.origin,g,l);h.pfLParam=0;return Math.max(i,0);}};f.prototype.sqrDistanceLine=function(m,t,r,p){var j=p.getOrientationCols();m.num=0;m.num0=0;m.num1=0;m.num2=0;var s=e.subtract(t.origin,p.position);var g=e.create(e.dotProduct(s,j[0]),e.dotProduct(s,j[1]),e.dotProduct(s,j[2]),0);var l=e.create(e.dotProduct(t.dir,j[0]),e.dotProduct(t.dir,j[1]),e.dotProduct(t.dir,j[2]),0);var k=c.toArray(g);var q=c.toArray(l);var h=[1,1,1,0];for(var o=0;o<3;o++){if(q[o]<0){k[o]=-k[o];q[o]=-q[o];h[o]=true;}else{h[o]=false;}}c.copyFromArray(g,k);c.copyFromArray(l,q);var n={};n.rkPnt=g.slice(0);n.pfLParam=0;n.rfSqrDistance=0;if(l[0]>0){if(l[1]>0){if(l[2]>0){this.caseNoZeros(n,l,r);m.num=n.pfLParam;}else{this.case0(n,0,1,2,l,r);m.num=n.pfLParam;}}else{if(l[2]>0){this.case0(n,0,2,1,l,r);m.num=n.pfLParam;}else{this.case00(n,0,1,2,l,r);m.num=n.pfLParam;}}}else{if(l[1]>0){if(l[2]>0){this.case0(n,1,2,0,l,r);m.num=n.pfLParam;}else{this.case00(n,1,0,2,l,r);m.num=n.pfLParam;}}else{if(l[2]>0){this.case00(n,2,0,1,l,r);m.num=n.pfLParam;}else{this.case000(n,r);m.num=0;}}}k=c.toArray(n.rkPnt);for(o=0;o<3;o++){if(h[o]){k[o]=-k[o];}}c.copyFromArray(n.rkPnt,k);m.num0=n.rkPnt[0];m.num1=n.rkPnt[1];m.num2=n.rkPnt[2];return Math.max(n.rfSqrDistance,0);};f.prototype.sqrDistancePoint=function(i,h,l,j){var n=j.getOrientationCols();var o=e.subtract(h,j.position);var k=e.create(e.dotProduct(o,n[0]),e.dotProduct(o,n[1]),e.dotProduct(o,n[2]),0);var g=0;var p;var m=l.getHalfSideLengths();if(k[0]<-m[0]){p=k[0]+m[0];g+=(p*p);k[0]=-m[0];}else{if(k[0]>m[0]){p=k[0]-m[0];g+=(p*p);k[0]=m[0];}}if(k[1]<-m[1]){p=k[1]+m[1];g+=(p*p);k[1]=-m[1];}else{if(k[1]>m[1]){p=k[1]-m[1];g+=(p*p);k[1]=m[1];}}if(k[2]<-m[2]){p=k[2]+m[2];g+=(p*p);k[2]=-m[2];}else{if(k[2]>m[2]){p=k[2]-m[2];g+=(p*p);k[2]=m[2];}}i.pfLParam0=k[0];i.pfLParam1=k[1];i.pfLParam2=k[2];return Math.max(g,0);};f.prototype.face=function(x,u,t,s,k,g,i){var y=[0,0,0,0];var l;var p;var n;var h;var z;var r;var w=g.getHalfSideLengths();var v=c.toArray(w);var j=c.toArray(x.rkPnt);var m=c.toArray(k);var o=c.toArray(y);var q=c.toArray(i);o[t]=j[t]+v[t];o[s]=j[s]+v[s];c.copyFromArray(i,o);if(m[u]*o[t]>=m[t]*q[u]){if(m[u]*o[s]>=m[s]*q[u]){j[u]=v[u];p=1/m[u];j[t]-=(m[t]*q[u]*p);j[s]-=(m[s]*q[u]*p);x.pfLParam=-q[u]*p;c.copyFromArray(x.rkPnt,j);}else{l=m[u]*m[u]+m[s]*m[s];n=l*o[t]-m[t]*(m[u]*q[u]+m[s]*o[s]);if(n<=2*l*v[t]){z=n/l;l+=(m[t]*m[t]);n=o[t]-z;r=m[u]*q[u]+m[t]*n+m[s]*o[s];h=-r/l;x.rfSqrDistance+=(q[u]*q[u]+n*n+o[s]*o[s]+r*h);x.pfLParam=h;j[u]=v[u];j[t]=z-v[t];j[s]=-v[s];c.copyFromArray(x.rkPnt,j);}else{l+=(m[t]*m[t]);r=m[u]*q[u]+m[t]*q[t]+m[s]*o[s];h=-r/l;x.rfSqrDistance+=(q[u]*q[u]+q[t]*q[t]+o[s]*o[s]+r*h);x.pfLParam=h;j[u]=v[u];j[t]=v[t];j[s]=-v[s];c.copyFromArray(x.rkPnt,j);}}}else{if(m[u]*o[s]>=m[s]*q[u]){l=m[u]*m[u]+m[t]*m[t];n=l*o[s]-m[s]*(m[u]*q[u]+m[t]*o[t]);if(n<=2*l*v[s]){z=n/l;l+=(m[s]*m[s]);n=o[s]-z;r=m[u]*q[u]+m[t]*o[t]+m[s]*n;h=-r/l;x.rfSqrDistance+=(q[u]*q[u]+o[t]*o[t]+n*n+r*h);x.pfLParam=h;j[u]=v[u];j[t]=-v[t];j[s]=z-v[s];c.copyFromArray(x.rkPnt,j);}else{l+=(m[s]*m[s]);r=m[u]*q[u]+m[t]*o[t]+m[s]*q[s];h=-r/l;x.rfSqrDistance+=(q[u]*q[u]+o[t]*o[t]+q[s]*q[s]+r*h);x.pfLParam=h;j[u]=v[u];j[t]=-v[t];j[s]=v[s];c.copyFromArray(x.rkPnt,j);}}else{l=m[u]*m[u]+m[s]*m[s];n=l*o[t]-m[t]*(m[u]*q[u]+m[s]*o[s]);if(n>=0){if(n<=2*l*v[t]){z=n/l;l+=(m[t]*m[t]);n=o[t]-z;r=m[u]*q[u]+m[t]*n+m[s]*o[s];h=-r/l;x.rfSqrDistance+=(q[u]*q[u]+n*n+o[s]*o[s]+r*h);x.pfLParam=h;j[u]=v[u];j[t]=z-v[t];j[s]=-v[s];c.copyFromArray(x.rkPnt,j);}else{l+=(m[t]*m[t]);r=m[u]*q[u]+m[t]*q[t]+m[s]*o[s];h=-r/l;x.rfSqrDistance+=(q[u]*q[u]+q[t]*q[t]+o[s]*o[s]+r*h);x.pfLParam=h;j[u]=v[u];j[t]=v[t];j[s]=-v[s];c.copyFromArray(x.rkPnt,j);}return;}l=m[u]*m[u]+m[t]*m[t];n=l*o[s]-m[s]*(m[u]*q[u]+m[t]*o[t]);if(n>=0){if(n<=2*l*v[s]){z=n/l;l+=(m[s]*m[s]);n=o[s]-z;r=m[u]*q[u]+m[t]*o[t]+m[s]*n;h=-r/l;x.rfSqrDistance+=(q[u]*q[u]+o[t]*o[t]+n*n+r*h);x.pfLParam=h;j[u]=v[u];j[t]=-v[t];j[s]=z-v[s];c.copyFromArray(x.rkPnt,j);}else{l+=(m[s]*m[s]);r=m[u]*q[u]+m[t]*o[t]+m[s]*q[s];h=-r/l;x.rfSqrDistance+=(q[u]*q[u]+o[t]*o[t]+q[s]*q[s]+r*h);x.pfLParam=h;j[u]=v[u];j[t]=-v[t];j[s]=v[s];c.copyFromArray(x.rkPnt,j);}return;}l+=(m[s]*m[s]);r=m[u]*q[u]+m[t]*o[t]+m[s]*o[s];h=-r/l;x.rfSqrDistance+=(q[u]*q[u]+o[t]*o[t]+o[s]*o[s]+r*h);x.pfLParam=h;j[u]=v[u];j[t]=-v[t];j[s]=-v[s];c.copyFromArray(x.rkPnt,j);}}};f.prototype.caseNoZeros=function(j,l,p){var q=p.getHalfSideLengths();var m=e.create(j.rkPnt[0]-q[0],j.rkPnt[1]-q[1],j.rkPnt[2]-q[2],0);var h=l[0]*m[1];var k=l[1]*m[0];var o;var g;var n;var i;if(k>=h){o=l[2]*m[0];g=l[0]*m[2];if(o>=g){this.face(j,0,1,2,l,p,m);}else{this.face(j,2,0,1,l,p,m);}}else{n=l[2]*m[1];i=l[1]*m[2];if(n>=i){this.face(j,1,2,0,l,p,m);}else{this.face(j,2,0,1,l,p,m);}}};f.prototype.case0=function(y,v,u,t,j,g){var x=g.getHalfSideLengths();var w=c.toArray(x);var i=c.toArray(y.rkPnt);var n=c.toArray(j);var r=i[v]-w[v];var q=i[u]-w[u];var k=n[u]*r;var h=n[v]*q;var s;var o;var p;if(k>=h){i[v]=w[v];var l=i[u]+w[u];s=k-n[v]*l;if(s>=0){o=1/(n[v]*n[v]+n[u]*n[u]);y.rfSqrDistance+=(s*s*o);i[u]=-w[u];y.pfLParam=-(n[v]*r+n[u]*l)*o;}else{p=1/n[v];i[u]-=(k*p);y.pfLParam=-r*p;}c.copyFromArray(y.rkPnt,i);}else{i[u]=w[u];var m=i[v]+w[v];s=h-n[u]*m;if(s>=0){o=1/(n[v]*n[v]+n[u]*n[u]);y.rfSqrDistance+=(s*s*o);i[v]=-w[v];y.pfLParam=-(n[v]*m+n[u]*q)*o;}else{p=1/n[u];i[v]-=(h*p);y.pfLParam=-q*p;}c.copyFromArray(y.rkPnt,i);}if(i[t]<-w[t]){s=i[t]+w[t];y.rfSqrDistance+=(s*s);i[t]=-w[t];}else{if(i[t]>w[t]){s=i[t]-w[t];y.rfSqrDistance+=(s*s);i[t]=w[t];}}c.copyFromArray(y.rkPnt,i);};f.prototype.case00=function(k,j,i,h,l,n){var p=0;var o=n.getHalfSideLengths();var g=c.toArray(o);var m=c.toArray(k.rkPnt);var q=c.toArray(l);k.pfLParam=(g[j]-m[j])/q[j];m[j]=g[j];if(m[i]<-g[i]){p=m[i]+g[i];k.rfSqrDistance+=(p*p);m[i]=-g[i];}else{if(m[i]>g[i]){p=m[i]-g[i];k.rfSqrDistance+=(p*p);m[i]=g[i];}}if(m[h]<-g[h]){p=m[h]+g[h];k.rfSqrDistance+=(p*p);m[h]=-g[h];}else{if(m[h]>g[h]){p=m[h]-g[h];k.rfSqrDistance+=(p*p);m[h]=g[h];}}c.copyFromArray(k.rkPnt,m);};f.prototype.case000=function(h,g){var i=0;var j=g.getHalfSideLengths();if(h.rkPnt[0]<-j[0]){i=h.rkPnt[0]+j[0];h.rfSqrDistance+=(i*i);h.rkPnt[0]=-j[0];}else{if(h.rkPnt[0]>j[0]){i=h.rkPnt[0]-j[0];h.rfSqrDistance+=(i*i);h.rkPnt[0]=j[0];}}if(h.rkPnt[1]<-j[1]){i=h.rkPnt[1]+j[1];h.rfSqrDistance+=(i*i);h.rkPnt[1]=-j[1];}else{if(h.rkPnt[1]>j[1]){i=h.rkPnt[1]-j[1];h.rfSqrDistance+=(i*i);h.rkPnt[1]=j[1];}}if(h.rkPnt[2]<-j[2]){i=h.rkPnt[2]+j[2];h.rfSqrDistance+=(i*i);h.rkPnt[2]=-j[2];}else{if(h.rkPnt[2]>j[2]){i=h.rkPnt[2]-j[2];h.rfSqrDistance+=(i*i);h.rkPnt[2]=j[2];}}};b.JSegment=f;})(jigLib);