(function(d){var i=d.Vector3DUtil;var a=d.JNumber3D;var g=d.JConstraint;var e=d.JConfig;var f=d.JSphere;var c=d.MaterialProperties;var k=d.RigidBody;var h=d.CollPointInfo;var j=d.CollisionInfo;var b=function(){this.name="SphereBox";this.type0="SPHERE";this.type1="BOX";};d.extend(b,d.CollDetectFunctor);b.prototype.collDetect=function(m,x){var t;if(m.body0.get_type()=="BOX"){t=m.body0;m.body0=m.body1;m.body1=t;}var q=m.body0;var r=m.body1;if(!q.hitTestObject3D(r)){return;}if(e.aabbDetection&&!q.get_boundingBox().overlapTest(r.get_boundingBox())){return;}var s={};var A={};var y=r.getDistanceToPoint(r.get_oldState(),s,q.get_oldState().position);var p=r.getDistanceToPoint(r.get_currentState(),A,q.get_currentState().position);var u=q.get_radius()-y;var w=q.get_radius()-p;if(Math.max(u,w)>-e.collToll){var o;var n=[];if(y<-a.NUM_TINY){o=i.subtract(i.subtract(s.pos,q.get_oldState().position),s.pos);i.normalize(o);}else{if(y>a.NUM_TINY){o=i.subtract(q.get_oldState().position,s.pos);i.normalize(o);}else{o=i.subtract(q.get_oldState().position,r.get_oldState().position);i.normalize(o);}}var l=new h();l.r0=i.subtract(s.pos,q.get_oldState().position);l.r1=i.subtract(s.pos,r.get_oldState().position);l.initialPenetration=u;n.push(l);var v=new j();v.objInfo=m;v.dirToBody=o;v.pointInfo=n;var z=new c();z.set_restitution(Math.sqrt(q.get_material().get_restitution()*r.get_material().get_restitution()));z.set_friction(Math.sqrt(q.get_material().get_friction()*r.get_material().get_friction()));v.mat=z;x.push(v);m.body0.collisions.push(v);m.body1.collisions.push(v);}};d.CollDetectSphereBox=b;})(jigLib);