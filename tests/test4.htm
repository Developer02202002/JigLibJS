<!DOCTYPE html>
<!-- stress test - alternating cubes and spheres -->
<html>
<head>

<title>GLGE with jigLib Demo</title>
<script type="text/javascript" src="../jiglib.js"></script>

<script type="text/javascript" src="../cof/jconfig.js"></script>

<script type="text/javascript" src="../maths/vector3d.js"></script>
<script type="text/javascript" src="../maths/matrix3d.js"></script>
<script type="text/javascript" src="../maths/jnumber3d.js"></script>
<script type="text/javascript" src="../maths/jmatrix3d.js"></script>
<script type="text/javascript" src="../maths/jmaths3d.js"></script>

<script type="text/javascript" src="../data/contactdata.js"></script>
<script type="text/javascript" src="../data/edgedata.js"></script>
<script type="text/javascript" src="../data/planedata.js"></script>
<script type="text/javascript" src="../data/spandata.js"></script>

<script type="text/javascript" src="../plugins/iskin3d.js"></script>

<script type="text/javascript" src="../geometry/jaabox.js"></script>

<script type="text/javascript" src="../physics/bodypair.js"></script>
<script type="text/javascript" src="../physics/cachedimpluse.js"></script>
<script type="text/javascript" src="../physics/materialproperties.js"></script>
<script type="text/javascript" src="../physics/physicscontroller.js"></script>
<script type="text/javascript" src="../physics/physicsstate.js"></script>
<script type="text/javascript" src="../physics/rigid_body.js"></script>
<script type="text/javascript" src="../physics/hingejoint.js"></script>

<script type="text/javascript" src="../geometry/jbox.js"></script>
<script type="text/javascript" src="../geometry/jcapsule.js"></script>
<script type="text/javascript" src="../geometry/jplane.js"></script>
<script type="text/javascript" src="../geometry/jray.js"></script>
<script type="text/javascript" src="../geometry/jsegment.js"></script>
<script type="text/javascript" src="../geometry/jsphere.js"></script>
<script type="text/javascript" src="../geometry/jterrain.js"></script>

<script type="text/javascript" src="../collision/collpointinfo.js"></script>
<script type="text/javascript" src="../collision/collisioninfo.js"></script>
<script type="text/javascript" src="../collision/colldetectinfo.js"></script>
<script type="text/javascript" src="../collision/colldetectfunctor.js"></script>
<script type="text/javascript" src="../collision/colldetectboxbox.js"></script>
<script type="text/javascript" src="../collision/colldetectboxplane.js"></script>
<script type="text/javascript" src="../collision/colldetectboxterrain.js"></script>
<script type="text/javascript" src="../collision/colldetectcapsulebox.js"></script>
<script type="text/javascript" src="../collision/colldetectcapsulecapsule.js"></script>
<script type="text/javascript" src="../collision/colldetectcapsuleplane.js"></script>
<script type="text/javascript" src="../collision/colldetectcapsuleterrain.js"></script>
<script type="text/javascript" src="../collision/colldetectspherebox.js"></script>
<script type="text/javascript" src="../collision/colldetectspherecapsule.js"></script>
<script type="text/javascript" src="../collision/colldetectsphereplane.js"></script>
<script type="text/javascript" src="../collision/colldetectspheresphere.js"></script>
<script type="text/javascript" src="../collision/colldetectsphereterrain.js"></script>
<script type="text/javascript" src="../collision/collisionsystem.js"></script>
<script type="text/javascript" src="../physics/constraint/jconstraint.js"></script>
<script type="text/javascript" src="../physics/constraint/jconstraintmaxdistance.js"></script>
<script type="text/javascript" src="../physics/constraint/jconstraintpoint.js"></script>
<script type="text/javascript" src="../physics/hingejoint.js"></script>


<script type="text/javascript" src="../physics/physicssystem.js"></script>
<script type="text/javascript" src="glge_math.js"></script> 
<script type="text/javascript" src="glge.js"></script> 
<style>
body{margin:auto; background-color: #888; padding-top: 50px; font-family:sans; color: #666; font-size: 0.8em}
#container{ margin:auto; width: 900px; padding: 10px; background-color: #fff; border-radius: 5px; -webkit-box-shadow: 5px 5px 2px #444; }
</style>
</head>
<body>


<div id="container">
<canvas id="canvas" width="900" height="400"></canvas>
<div id="details">
	<h2>GLGE JigLib Demo</h2>
	<div id="debug" />
	<div id="framerate" />
	<p>This demo illustrates the use of jiglib with GLGE is offers simple 3D physics within javascript</p>
</div>



<script id="glge_document" type="text/xml">
	<glge>

		<mesh id="groundMesh">
			<positions>1.000,1.000,0.000,-1.000,1.000,0.000,-1.000,-1.000,0.000,1.000,1.000,0.000,-1.000,-1.000,0.000,1.000,-1.000,0.000</positions>
			<normals>-0.000,0.000,1.000,-0.000,0.000,1.000,-0.000,0.000,1.000,0.000,-0.000,1.000,0.000,-0.000,1.000,0.000,-0.000,1.000</normals>
			<uv1>0.000,0.000,1.000,0.000,1.000,1.000,0.000,0.000,1.000,1.000,0.000,1.000</uv1>
			<faces>0,1,2,3,4,5,</faces>
		</mesh>

		<mesh id="Sphere">
			<positions>0.262869,-0.809012,-0.525738,0.425323,-0.309011,-0.850654,0.723600,-0.525720,-0.447215,0.425323,-0.309011,-0.850654,0.262869,-0.809012,-0.525738,-0.162456,-0.499995,-0.850654,-0.276385,-0.850640,-0.447215,-0.162456,-0.499995,-0.850654,0.262869,-0.809012,-0.525738,-0.162456,-0.499995,-0.850654,0.000000,0.000000,-1.000000,0.425323,-0.309011,-0.850654,0.850648,0.000000,-0.525736,0.723600,-0.525720,-0.447215,0.425323,-0.309011,-0.850654,0.425323,-0.309011,-0.850654,0.425323,0.309011,-0.850654,0.850648,0.000000,-0.525736,0.723600,0.525720,-0.447215,0.850648,0.000000,-0.525736,0.425323,0.309011,-0.850654,0.425323,-0.309011,-0.850654,0.000000,0.000000,-1.000000,0.425323,0.309011,-0.850654,-0.688189,-0.499997,-0.525736,-0.162456,-0.499995,-0.850654,-0.276385,-0.850640,-0.447215,-0.162456,-0.499995,-0.850654,-0.688189,-0.499997,-0.525736,-0.525730,0.000000,-0.850652,-0.894425,0.000000,-0.447215,-0.525730,0.000000,-0.850652,-0.688189,-0.499997,-0.525736,-0.525730,0.000000,-0.850652,0.000000,0.000000,-1.000000,-0.162456,-0.499995,-0.850654,-0.688189,0.499997,-0.525736,-0.525730,0.000000,-0.850652,-0.894425,0.000000,-0.447215,-0.525730,0.000000,-0.850652,-0.688189,0.499997,-0.525736,-0.162456,0.499995,-0.850654,-0.276385,0.850640,-0.447215,-0.162456,0.499995,-0.850654,-0.688189,0.499997,-0.525736,-0.162456,0.499995,-0.850654,0.000000,0.000000,-1.000000,-0.525730,0.000000,-0.850652,0.262869,0.809012,-0.525738,-0.162456,0.499995,-0.850654,-0.276385,0.850640,-0.447215,-0.162456,0.499995,-0.850654,0.262869,0.809012,-0.525738,0.425323,0.309011,-0.850654,0.723600,0.525720,-0.447215,0.425323,0.309011,-0.850654,0.262869,0.809012,-0.525738,0.425323,0.309011,-0.850654,0.000000,0.000000,-1.000000,-0.162456,0.499995,-0.850654,0.951058,-0.309013,0.000000,0.723600,-0.525720,-0.447215,0.850648,0.000000,-0.525736,0.850648,0.000000,-0.525736,0.951058,0.309013,0.000000,0.951058,-0.309013,0.000000,0.894425,0.000000,0.447215,0.951058,-0.309013,0.000000,0.951058,0.309013,0.000000,0.951058,0.309013,0.000000,0.850648,0.000000,-0.525736,0.723600,0.525720,-0.447215,0.000000,-1.000000,0.000000,-0.276385,-0.850640,-0.447215,0.262869,-0.809012,-0.525738,0.262869,-0.809012,-0.525738,0.587786,-0.809017,0.000000,0.000000,-1.000000,0.000000,0.276385,-0.850640,0.447215,0.000000,-1.000000,0.000000,0.587786,-0.809017,0.000000,0.587786,-0.809017,0.000000,0.262869,-0.809012,-0.525738,0.723600,-0.525720,-0.447215,-0.951058,-0.309013,0.000000,-0.894425,0.000000,-0.447215,-0.688189,-0.499997,-0.525736,-0.688189,-0.499997,-0.525736,-0.587786,-0.809017,0.000000,-0.951058,-0.309013,0.000000,-0.723600,-0.525720,0.447215,-0.951058,-0.309013,0.000000,-0.587786,-0.809017,0.000000,-0.587786,-0.809017,0.000000,-0.688189,-0.499997,-0.525736,-0.276385,-0.850640,-0.447215,-0.587786,0.809017,0.000000,-0.276385,0.850640,-0.447215,-0.688189,0.499997,-0.525736,-0.688189,0.499997,-0.525736,-0.951058,0.309013,0.000000,-0.587786,0.809017,0.000000,-0.723600,0.525720,0.447215,-0.587786,0.809017,0.000000,-0.951058,0.309013,0.000000,-0.951058,0.309013,0.000000,-0.688189,0.499997,-0.525736,-0.894425,0.000000,-0.447215,0.587786,0.809017,0.000000,0.723600,0.525720,-0.447215,0.262869,0.809012,-0.525738,0.262869,0.809012,-0.525738,0.000000,1.000000,0.000000,0.587786,0.809017,0.000000,0.276385,0.850640,0.447215,0.587786,0.809017,0.000000,0.000000,1.000000,0.000000,0.000000,1.000000,0.000000,0.262869,0.809012,-0.525738,-0.276385,0.850640,-0.447215,0.688189,-0.499997,0.525736,0.951058,-0.309013,0.000000,0.894425,0.000000,0.447215,0.951058,-0.309013,0.000000,0.688189,-0.499997,0.525736,0.587786,-0.809017,0.000000,0.276385,-0.850640,0.447215,0.587786,-0.809017,0.000000,0.688189,-0.499997,0.525736,0.587786,-0.809017,0.000000,0.723600,-0.525720,-0.447215,0.951058,-0.309013,0.000000,-0.262869,-0.809012,0.525738,0.000000,-1.000000,0.000000,0.276385,-0.850640,0.447215,0.000000,-1.000000,0.000000,-0.262869,-0.809012,0.525738,-0.587786,-0.809017,0.000000,-0.723600,-0.525720,0.447215,-0.587786,-0.809017,0.000000,-0.262869,-0.809012,0.525738,-0.587786,-0.809017,0.000000,-0.276385,-0.850640,-0.447215,0.000000,-1.000000,0.000000,-0.850648,0.000000,0.525736,-0.951058,-0.309013,0.000000,-0.723600,-0.525720,0.447215,-0.951058,-0.309013,0.000000,-0.850648,0.000000,0.525736,-0.951058,0.309013,0.000000,-0.723600,0.525720,0.447215,-0.951058,0.309013,0.000000,-0.850648,0.000000,0.525736,-0.951058,0.309013,0.000000,-0.894425,0.000000,-0.447215,-0.951058,-0.309013,0.000000,-0.262869,0.809012,0.525738,-0.587786,0.809017,0.000000,-0.723600,0.525720,0.447215,-0.587786,0.809017,0.000000,-0.262869,0.809012,0.525738,0.000000,1.000000,0.000000,0.276385,0.850640,0.447215,0.000000,1.000000,0.000000,-0.262869,0.809012,0.525738,0.000000,1.000000,0.000000,-0.276385,0.850640,-0.447215,-0.587786,0.809017,0.000000,0.688189,0.499997,0.525736,0.587786,0.809017,0.000000,0.276385,0.850640,0.447215,0.587786,0.809017,0.000000,0.688189,0.499997,0.525736,0.951058,0.309013,0.000000,0.894425,0.000000,0.447215,0.951058,0.309013,0.000000,0.688189,0.499997,0.525736,0.951058,0.309013,0.000000,0.723600,0.525720,-0.447215,0.587786,0.809017,0.000000,0.162456,-0.499995,0.850654,0.276385,-0.850640,0.447215,0.688189,-0.499997,0.525736,0.688189,-0.499997,0.525736,0.525730,0.000000,0.850652,0.162456,-0.499995,0.850654,0.000000,0.000000,1.000000,0.162456,-0.499995,0.850654,0.525730,0.000000,0.850652,0.525730,0.000000,0.850652,0.688189,-0.499997,0.525736,0.894425,0.000000,0.447215,-0.425323,-0.309011,0.850654,-0.723600,-0.525720,0.447215,-0.262869,-0.809012,0.525738,-0.262869,-0.809012,0.525738,0.162456,-0.499995,0.850654,-0.425323,-0.309011,0.850654,0.000000,0.000000,1.000000,-0.425323,-0.309011,0.850654,0.162456,-0.499995,0.850654,0.162456,-0.499995,0.850654,-0.262869,-0.809012,0.525738,0.276385,-0.850640,0.447215,-0.425323,0.309011,0.850654,-0.723600,0.525720,0.447215,-0.850648,0.000000,0.525736,-0.850648,0.000000,0.525736,-0.425323,-0.309011,0.850654,-0.425323,0.309011,0.850654,0.000000,0.000000,1.000000,-0.425323,0.309011,0.850654,-0.425323,-0.309011,0.850654,-0.425323,-0.309011,0.850654,-0.850648,0.000000,0.525736,-0.723600,-0.525720,0.447215,0.162456,0.499995,0.850654,0.276385,0.850640,0.447215,-0.262869,0.809012,0.525738,-0.262869,0.809012,0.525738,-0.425323,0.309011,0.850654,0.162456,0.499995,0.850654,0.000000,0.000000,1.000000,0.162456,0.499995,0.850654,-0.425323,0.309011,0.850654,-0.425323,0.309011,0.850654,-0.262869,0.809012,0.525738,-0.723600,0.525720,0.447215,0.525730,0.000000,0.850652,0.894425,0.000000,0.447215,0.688189,0.499997,0.525736,0.688189,0.499997,0.525736,0.162456,0.499995,0.850654,0.525730,0.000000,0.850652,0.000000,0.000000,1.000000,0.525730,0.000000,0.850652,0.162456,0.499995,0.850654,0.162456,0.499995,0.850654,0.688189,0.499997,0.525736,0.276385,0.850640,0.447215</positions>
			<normals>0.262856,-0.808985,-0.525712,0.425306,-0.309000,-0.850642,0.723594,-0.525712,-0.447188,0.425306,-0.309000,-0.850642,0.262856,-0.808985,-0.525712,-0.162450,-0.499985,-0.850642,-0.276376,-0.850642,-0.447188,-0.162450,-0.499985,-0.850642,0.262856,-0.808985,-0.525712,-0.162450,-0.499985,-0.850642,0.000000,0.000000,-1.000000,0.425306,-0.309000,-0.850642,0.850642,0.000000,-0.525712,0.723594,-0.525712,-0.447188,0.425306,-0.309000,-0.850642,0.425306,-0.309000,-0.850642,0.425306,0.309000,-0.850642,0.850642,0.000000,-0.525712,0.723594,0.525712,-0.447188,0.850642,0.000000,-0.525712,0.425306,0.309000,-0.850642,0.425306,-0.309000,-0.850642,0.000000,0.000000,-1.000000,0.425306,0.309000,-0.850642,-0.688162,-0.499985,-0.525712,-0.162450,-0.499985,-0.850642,-0.276376,-0.850642,-0.447188,-0.162450,-0.499985,-0.850642,-0.688162,-0.499985,-0.525712,-0.525712,0.000000,-0.850642,-0.894406,0.000000,-0.447188,-0.525712,0.000000,-0.850642,-0.688162,-0.499985,-0.525712,-0.525712,0.000000,-0.850642,0.000000,0.000000,-1.000000,-0.162450,-0.499985,-0.850642,-0.688162,0.499985,-0.525712,-0.525712,0.000000,-0.850642,-0.894406,0.000000,-0.447188,-0.525712,0.000000,-0.850642,-0.688162,0.499985,-0.525712,-0.162450,0.499985,-0.850642,-0.276376,0.850642,-0.447188,-0.162450,0.499985,-0.850642,-0.688162,0.499985,-0.525712,-0.162450,0.499985,-0.850642,0.000000,0.000000,-1.000000,-0.525712,0.000000,-0.850642,0.262856,0.808985,-0.525712,-0.162450,0.499985,-0.850642,-0.276376,0.850642,-0.447188,-0.162450,0.499985,-0.850642,0.262856,0.808985,-0.525712,0.425306,0.309000,-0.850642,0.723594,0.525712,-0.447188,0.425306,0.309000,-0.850642,0.262856,0.808985,-0.525712,0.425306,0.309000,-0.850642,0.000000,0.000000,-1.000000,-0.162450,0.499985,-0.850642,0.951048,-0.309000,0.000000,0.723594,-0.525712,-0.447188,0.850642,0.000000,-0.525712,0.850642,0.000000,-0.525712,0.951048,0.309000,0.000000,0.951048,-0.309000,0.000000,0.894406,0.000000,0.447188,0.951048,-0.309000,0.000000,0.951048,0.309000,0.000000,0.951048,0.309000,0.000000,0.850642,0.000000,-0.525712,0.723594,0.525712,-0.447188,0.000000,-1.000000,0.000000,-0.276376,-0.850642,-0.447188,0.262856,-0.808985,-0.525712,0.262856,-0.808985,-0.525712,0.587756,-0.809015,0.000000,0.000000,-1.000000,0.000000,0.276376,-0.850642,0.447188,0.000000,-1.000000,0.000000,0.587756,-0.809015,0.000000,0.587756,-0.809015,0.000000,0.262856,-0.808985,-0.525712,0.723594,-0.525712,-0.447188,-0.951048,-0.309000,0.000000,-0.894406,0.000000,-0.447188,-0.688162,-0.499985,-0.525712,-0.688162,-0.499985,-0.525712,-0.587756,-0.809015,0.000000,-0.951048,-0.309000,0.000000,-0.723594,-0.525712,0.447188,-0.951048,-0.309000,0.000000,-0.587756,-0.809015,0.000000,-0.587756,-0.809015,0.000000,-0.688162,-0.499985,-0.525712,-0.276376,-0.850642,-0.447188,-0.587756,0.809015,0.000000,-0.276376,0.850642,-0.447188,-0.688162,0.499985,-0.525712,-0.688162,0.499985,-0.525712,-0.951048,0.309000,0.000000,-0.587756,0.809015,0.000000,-0.723594,0.525712,0.447188,-0.587756,0.809015,0.000000,-0.951048,0.309000,0.000000,-0.951048,0.309000,0.000000,-0.688162,0.499985,-0.525712,-0.894406,0.000000,-0.447188,0.587756,0.809015,0.000000,0.723594,0.525712,-0.447188,0.262856,0.808985,-0.525712,0.262856,0.808985,-0.525712,0.000000,1.000000,0.000000,0.587756,0.809015,0.000000,0.276376,0.850642,0.447188,0.587756,0.809015,0.000000,0.000000,1.000000,0.000000,0.000000,1.000000,0.000000,0.262856,0.808985,-0.525712,-0.276376,0.850642,-0.447188,0.688162,-0.499985,0.525712,0.951048,-0.309000,0.000000,0.894406,0.000000,0.447188,0.951048,-0.309000,0.000000,0.688162,-0.499985,0.525712,0.587756,-0.809015,0.000000,0.276376,-0.850642,0.447188,0.587756,-0.809015,0.000000,0.688162,-0.499985,0.525712,0.587756,-0.809015,0.000000,0.723594,-0.525712,-0.447188,0.951048,-0.309000,0.000000,-0.262856,-0.808985,0.525712,0.000000,-1.000000,0.000000,0.276376,-0.850642,0.447188,0.000000,-1.000000,0.000000,-0.262856,-0.808985,0.525712,-0.587756,-0.809015,0.000000,-0.723594,-0.525712,0.447188,-0.587756,-0.809015,0.000000,-0.262856,-0.808985,0.525712,-0.587756,-0.809015,0.000000,-0.276376,-0.850642,-0.447188,0.000000,-1.000000,0.000000,-0.850642,0.000000,0.525712,-0.951048,-0.309000,0.000000,-0.723594,-0.525712,0.447188,-0.951048,-0.309000,0.000000,-0.850642,0.000000,0.525712,-0.951048,0.309000,0.000000,-0.723594,0.525712,0.447188,-0.951048,0.309000,0.000000,-0.850642,0.000000,0.525712,-0.951048,0.309000,0.000000,-0.894406,0.000000,-0.447188,-0.951048,-0.309000,0.000000,-0.262856,0.808985,0.525712,-0.587756,0.809015,0.000000,-0.723594,0.525712,0.447188,-0.587756,0.809015,0.000000,-0.262856,0.808985,0.525712,0.000000,1.000000,0.000000,0.276376,0.850642,0.447188,0.000000,1.000000,0.000000,-0.262856,0.808985,0.525712,0.000000,1.000000,0.000000,-0.276376,0.850642,-0.447188,-0.587756,0.809015,0.000000,0.688162,0.499985,0.525712,0.587756,0.809015,0.000000,0.276376,0.850642,0.447188,0.587756,0.809015,0.000000,0.688162,0.499985,0.525712,0.951048,0.309000,0.000000,0.894406,0.000000,0.447188,0.951048,0.309000,0.000000,0.688162,0.499985,0.525712,0.951048,0.309000,0.000000,0.723594,0.525712,-0.447188,0.587756,0.809015,0.000000,0.162450,-0.499985,0.850642,0.276376,-0.850642,0.447188,0.688162,-0.499985,0.525712,0.688162,-0.499985,0.525712,0.525712,0.000000,0.850642,0.162450,-0.499985,0.850642,0.000000,0.000000,1.000000,0.162450,-0.499985,0.850642,0.525712,0.000000,0.850642,0.525712,0.000000,0.850642,0.688162,-0.499985,0.525712,0.894406,0.000000,0.447188,-0.425306,-0.309000,0.850642,-0.723594,-0.525712,0.447188,-0.262856,-0.808985,0.525712,-0.262856,-0.808985,0.525712,0.162450,-0.499985,0.850642,-0.425306,-0.309000,0.850642,0.000000,0.000000,1.000000,-0.425306,-0.309000,0.850642,0.162450,-0.499985,0.850642,0.162450,-0.499985,0.850642,-0.262856,-0.808985,0.525712,0.276376,-0.850642,0.447188,-0.425306,0.309000,0.850642,-0.723594,0.525712,0.447188,-0.850642,0.000000,0.525712,-0.850642,0.000000,0.525712,-0.425306,-0.309000,0.850642,-0.425306,0.309000,0.850642,0.000000,0.000000,1.000000,-0.425306,0.309000,0.850642,-0.425306,-0.309000,0.850642,-0.425306,-0.309000,0.850642,-0.850642,0.000000,0.525712,-0.723594,-0.525712,0.447188,0.162450,0.499985,0.850642,0.276376,0.850642,0.447188,-0.262856,0.808985,0.525712,-0.262856,0.808985,0.525712,-0.425306,0.309000,0.850642,0.162450,0.499985,0.850642,0.000000,0.000000,1.000000,0.162450,0.499985,0.850642,-0.425306,0.309000,0.850642,-0.425306,0.309000,0.850642,-0.262856,0.808985,0.525712,-0.723594,0.525712,0.447188,0.525712,0.000000,0.850642,0.894406,0.000000,0.447188,0.688162,0.499985,0.525712,0.688162,0.499985,0.525712,0.162450,0.499985,0.850642,0.525712,0.000000,0.850642,0.000000,0.000000,1.000000,0.525712,0.000000,0.850642,0.162450,0.499985,0.850642,0.162450,0.499985,0.850642,0.688162,0.499985,0.525712,0.276376,0.850642,0.447188</normals>
			<faces>0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239</faces>
		</mesh>
		
		<mesh id="Cube">
			<positions>1.000,1.000,1.000,1.000,1.000,-1.000,-1.000,1.000,-1.000,1.000,1.000,1.000,-1.000,1.000,-1.000,-1.000,1.000,1.000,-1.000,-1.000,-1.000,-1.000,-1.000,1.000,-1.000,1.000,1.000,-1.000,-1.000,-1.000,-1.000,1.000,1.000,-1.000,1.000,-1.000,1.000,-1.000,-1.000,1.000,-1.000,1.000,-1.000,-1.000,-1.000,1.000,-1.000,1.000,-1.000,-1.000,1.000,-1.000,-1.000,-1.000,1.000,1.000,-1.000,1.000,1.000,1.000,1.000,-1.000,-1.000,1.000,1.000,1.000,1.000,-1.000,1.000,1.000,-1.000,-1.000,1.000,1.000,1.000,-1.000,1.000,1.000,1.000,-1.000,1.000,-1.000,1.000,1.000,-1.000,-1.000,1.000,1.000,-1.000,1.000,1.000,1.000,-1.000,1.000,-1.000,-1.000,-1.000,-1.000,-1.000,1.000,1.000,-1.000,-1.000,-1.000,-1.000,-1.000,1.000,-1.000</positions>
			<normals>0.000,1.000,0.000,0.000,1.000,0.000,0.000,1.000,0.000,0.000,1.000,0.000,0.000,1.000,0.000,0.000,1.000,0.000,-1.000,0.000,-0.000,-1.000,0.000,-0.000,-1.000,0.000,-0.000,-1.000,0.000,-0.000,-1.000,0.000,-0.000,-1.000,0.000,-0.000,-0.000,-1.000,-0.000,-0.000,-1.000,-0.000,-0.000,-1.000,-0.000,-0.000,-1.000,0.000,-0.000,-1.000,0.000,-0.000,-1.000,0.000,1.000,0.000,-0.000,1.000,0.000,-0.000,1.000,0.000,-0.000,1.000,-0.000,0.000,1.000,-0.000,0.000,1.000,-0.000,0.000,-0.000,-0.000,1.000,-0.000,-0.000,1.000,-0.000,-0.000,1.000,0.000,-0.000,1.000,0.000,-0.000,1.000,0.000,-0.000,1.000,0.000,0.000,-1.000,0.000,0.000,-1.000,0.000,0.000,-1.000,0.000,-0.000,-1.000,0.000,-0.000,-1.000,0.000,-0.000,-1.000</normals>
			<faces>0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35</faces>
		</mesh>



		<material id="green" specular="0" shininess="20" color="green" />
		
		<material id="yellow" specular="0" shininess="20" color="yellow" />
		<material id="red" specular="0" shininess="20" color="red" />
		<material id="blue" specular="0" shininess="20" color="blue" />
		<material id="grid" specular="0" shininess="20">
			<texture id="grid-tex" src="grid.png" />
			<material_layer texture="#grid-tex" mapinput="UV1" scale_x="2" scale_y="2" scale_z="2" mapto="M_COLOR" />
		</material>

		<scene id="mainscene" ambient_color="#555" camera="#mainCamera" background_color="#338">
		
			<camera id="mainCamera" loc_z="7" loc_y="6.0" fov_y="35" rot_x="-0.6" />
			
			<object id="groundObject" mesh="#groundMesh" material="#grid" rot_x="-1.57"  scale="15" />
			
			<object id="CubeObject" mesh="#Cube" loc_y="2" scale="0.5" material="#green" />
			<object id="CubeObject2" mesh="#Cube" loc_y="3" scale="0.5" material="#green" />
			
			<light id="light1" loc_x="-3" loc_y="15" loc_z="-7" attenuation_quadratic="0.00001" attenuation_linear="0.00000001" attenuation_constant="1" type="L_POINT" />
		
			<light id="light2" loc_x="3" loc_y="15" loc_z="7" attenuation_quadratic="0.00001" attenuation_linear="0.00000001" attenuation_constant="1.5" type="L_POINT" />
			
		</scene>
	</glge>
</script>

<script>

var canvas = document.getElementById( 'canvas' )
var renderer = new GLGE.Renderer( canvas );

var XMLdoc = new GLGE.Document();

XMLdoc.onLoad = function(){
	var scene = XMLdoc.getElement( "mainscene" );
	renderer.setScene( scene );
	renderer.render();
	var cubeObj = XMLdoc.getElement( "CubeObject" );
	var cubeObj2 = XMLdoc.getElement( "CubeObject2" );
	var camera = XMLdoc.getElement( "mainCamera" );
	var green = XMLdoc.getElement( "green" );
	var materials=[
	XMLdoc.getElement( "red" ),
	XMLdoc.getElement( "yellow" ),
	XMLdoc.getElement( "blue" )
	];
	var smesh = XMLdoc.getElement( "Sphere" );
	var cmesh = XMLdoc.getElement( "Cube" );
	
	var links=[];
	
	var addSphere=function(){
		var radius=Math.random()/1.5+0.2;
		var newObject=new GLGE.Object();
		newObject.setMesh(smesh);
		var mat=materials[(Math.random()*3)|0];
		newObject.setMaterial(mat);
		newObject.setScale(radius);
		scene.addObject(newObject);
		var sphere=new jigLib.JSphere(null,radius);
		sphere.set_mass(4/3*radius*radius*radius*Math.PI);
		sphere.set_friction(1);
		system.addBody(sphere);
		sphere.moveTo(new jigLib.Vector3D(0,10,0));
		links.push({glge:newObject,jig:sphere})
	}
	
	var addCube=function(){
		var width=Math.random()*1.5+0.15;
		var height=Math.random()*1.5+0.15;
		var depth=Math.random()*1.5+0.15;
		var newObject=new GLGE.Object();
		newObject.setMesh(cmesh);
		var mat=materials[(Math.random()*3)|0];
		newObject.setMaterial(mat);
		newObject.setScaleY(depth/2);
		newObject.setScaleX(width/2);
		newObject.setScaleZ(height/2);
		scene.addObject(newObject);
		var cube=new jigLib.JBox(null,width,height,depth);
		cube.set_rotVelocityDamping(new jigLib.Vector3D(0.2, 0.2, 0.2));
		cube.set_rotVelocityDamping(new jigLib.Vector3D(0.1, 0.1, 0.1));
		cube.set_mass(width*height*depth);
		cube.set_restitution(0);
		cube.set_friction(1);
		system.addBody(cube);
		cube.moveTo(new jigLib.Vector3D(0,10,0));
		links.push({glge:newObject,jig:cube})
	}
	
	var addwall=function(){
		for(var x=1;x<5;x++){
			for(var i=0;i<7;i++){
				var newObject=new GLGE.Object();
				newObject.setMesh(cmesh);
				newObject.setMaterial(green);
				newObject.setScaleY(0.15);
				newObject.setScaleX(0.5);
				newObject.setLocX(-x*1);
				newObject.setScaleZ(0.25);
				scene.addObject(newObject);
				var sphere=new jigLib.JBox(null,1,0.5,0.3);
				sphere.set_mass(100);
				system.addBody(sphere);
				sphere.get_currentState().position.y=i*0.29+0.15;
				sphere.get_currentState().position.x=-x*1.0+0.5+0.5*(i%2);
				sphere.get_material().set_friction(0.2);
				sphere.get_material().set_restitution(0.2);
				system.integrate(0.001);
				sphere.setInactive()
				links.push({glge:newObject,jig:sphere})
			}
		}
	}
	
	var system=jigLib.PhysicsSystem.getInstance();
	system.setGravity(new jigLib.Vector3D(0,-9.8,0));
	var plane=new jigLib.JPlane(null,new jigLib.Vector3D(0, 1, 0));
	plane.set_friction(0.99);
	
	var cube=new jigLib.JBox(null,1,1,1);
	cube.set_mass(1);
		cube.set_restitution(0);
		cube.set_friction(0);
	cube.set_linVelocityDamping(new jigLib.Vector3D(0.95, 0.95, 0.95));
	cube.set_rotVelocityDamping(new jigLib.Vector3D(0.1, 0.1, 0.1));
	
	var cube2=new jigLib.JBox(null,1,1,1);
	cube2.set_mass(1);
		cube2.set_restitution(0);
		cube2.set_friction(0);
	cube2.set_linVelocityDamping(new jigLib.Vector3D(0.95, 0.95, 0.95));
	cube2.moveTo(new jigLib.Vector3D(0, 1.5, 0));
	
	
	
	system.addBody(plane);
	system.addBody(cube);
	system.addBody(cube2);
	cube.moveTo(new jigLib.Vector3D(1, 1.5, 0));
	
	links.push({glge:cubeObj,jig:cube});
	links.push({glge:cubeObj2,jig:cube2});
	
	var lasttime=(new Date()).getTime();
	var renders = 0;
	function render(){
		var now=(new Date()).getTime();
		var inttime=(now-lasttime)/1000;
		if (inttime<0.05) inttime=0.05;
		system.integrate(inttime);
		lasttime=now;
		
		var linkCount = links.length;
		for(var i=0; i<linkCount;i++){
			links[i].glge.setLocY(links[i].jig.get_currentState().position.y);
			links[i].glge.setLocX(links[i].jig.get_currentState().position.x);
			links[i].glge.setLocZ(links[i].jig.get_currentState().position.z);
			var ori=GLGE.Mat4(links[i].jig.get_currentState().get_orientation().rawData);
			links[i].glge.setRotMatrix(ori);
		}
		
		renderer.render();
		
		renders++;
	}
	
	setInterval(render,30);
	
	// test code
	console.profile();
	var testNum = 0, testLimit = 60, testGap = 250, testBusy = false;
	var testStart = new Date().getTime();
	var testAdd = function(){
		if ((testNum % 2) == 0) addSphere(); else addCube();
	}
	
	var testRunner = setInterval(function(){
			if(!testBusy)
			{
				testBusy = true;
				testNum++;
				testAdd();
				if (testNum == testLimit) {
					clearInterval(testRunner);
					console.profileEnd();
					var seconds = ((new Date().getTime() - testStart)/1000).toString();
					var avgRPS = renders / seconds;
					alert('seconds taken: '+seconds+'\nrenders: '+renders+'\naverage renders per second: '+avgRPS);
				}
				testBusy = false;
			}
		}, testGap);
}

XMLdoc.parseScript("glge_document");

</script>
</body>
</html>

